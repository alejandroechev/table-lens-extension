<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test Chart - Debug</title>
  <script src="libs/chart.umd.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .chart-container {
      height: 400px;
      margin: 20px 0;
    }
    #testChart {
      max-height: 400px;
    }
    .test-data {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Chart.js Test Page</h1>
    
    <div class="test-data">
      <h3>Test Data</h3>
      <p>This page will test Chart.js functionality with sample data.</p>
    </div>
    
    <button onclick="testChart()">Test Chart</button>
    <button onclick="clearChart()">Clear Chart</button>
    
    <div class="chart-container">
      <canvas id="testChart" width="400" height="400"></canvas>
    </div>
    
    <div id="status"></div>
  </div>

  <script>
    let testChartInstance = null;
    
    function log(message) {
      console.log(message);
      const status = document.getElementById('status');
      status.innerHTML += '<p>' + message + '</p>';
    }
    
    function clearStatus() {
      document.getElementById('status').innerHTML = '';
    }
    
    function clearChart() {
      if (testChartInstance) {
        testChartInstance.destroy();
        testChartInstance = null;
      }
      clearStatus();
    }
    
    function testChart() {
      clearStatus();
      
      log('Testing Chart.js functionality...');
      
      // Check if Chart.js is loaded
      if (typeof Chart === 'undefined') {
        log('❌ ERROR: Chart.js is not loaded!');
        return;
      }
      
      log('✅ Chart.js is loaded: ' + Chart.version);
      
      // Sample data similar to what your extension would use
      const testData = {
        labels: ['January', 'February', 'March', 'April', 'May'],
        datasets: [{
          label: 'Sales',
          data: [12, 19, 3, 5, 2],
          backgroundColor: [
            '#667eea',
            '#764ba2', 
            '#f093fb',
            '#f5576c',
            '#4facfe'
          ],
          borderColor: [
            '#5a6fd8',
            '#6a4190',
            '#e881e9',
            '#e3455a',
            '#3d9aec'
          ],
          borderWidth: 1
        }]
      };
      
      const config = {
        type: 'bar',
        data: testData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'Test Chart - Monthly Sales',
              font: {
                size: 16,
                weight: 'bold'
              },
              padding: 20
            },
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Sales Amount'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Month'
              }
            }
          }
        }
      };
      
      try {
        const ctx = document.getElementById('testChart').getContext('2d');
        log('✅ Canvas context obtained');
        
        if (testChartInstance) {
          testChartInstance.destroy();
        }
        
        testChartInstance = new Chart(ctx, config);
        log('✅ Chart created successfully!');
        
        // Test the same data format your extension uses
        setTimeout(() => {
          log('Testing extension data format...');
          testExtensionDataFormat();
        }, 1000);
        
      } catch (error) {
        log('❌ ERROR creating chart: ' + error.message);
        console.error(error);
      }
    }
    
    function testExtensionDataFormat() {
      // Test with data format similar to what your extension processes
      const extensionData = [
        ['Month', 'Sales', 'Profit'],  // Header row
        ['January', '12', '5'],
        ['February', '19', '8'], 
        ['March', '3', '1'],
        ['April', '5', '2'],
        ['May', '2', '1']
      ];
      
      try {
        // Process data like your extension does
        const headers = extensionData[0];
        const rows = extensionData.slice(1);
        
        // Extract labels (X-axis data)
        const labels = rows.map(row => row[0] || '');
        
        // Extract datasets (Y-axis data) - using column 1 (Sales)
        const datasets = [{
          label: headers[1],  // 'Sales'
          data: rows.map(row => {
            const value = row[1];  // Sales column
            return parseFloat(value) || 0;
          }),
          backgroundColor: '#667eea',
          borderColor: '#5a6fd8',
          borderWidth: 1
        }];
        
        const chartData = {
          labels: labels,
          datasets: datasets
        };
        
        const config = {
          type: 'line',
          data: chartData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: {
                display: true,
                text: 'Extension Data Format Test',
                font: {
                  size: 16,
                  weight: 'bold'
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        };
        
        if (testChartInstance) {
          testChartInstance.destroy();
        }
        
        const ctx = document.getElementById('testChart').getContext('2d');
        testChartInstance = new Chart(ctx, config);
        
        log('✅ Extension data format test successful!');
        log('Data processed: ' + rows.length + ' rows, Labels: ' + labels.join(', '));
        
      } catch (error) {
        log('❌ ERROR with extension data format: ' + error.message);
        console.error(error);
      }
    }
    
    // Auto-run test on page load
    window.addEventListener('load', () => {
      log('Page loaded. Click "Test Chart" to begin testing.');
    });
  </script>
</body>
</html>