<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test Column Filters - TableLens</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
    button { padding: 8px 16px; margin: 5px; }
  </style>
</head>
<body>
  <h1>Excel-Style Column Filter Testing</h1>
  
  <div class="test-section">
    <h3>Test Data Table - Excel-Style Filters</h3>
    <p>This table contains mixed data types for testing Excel-style column filters:</p>
    <ul>
      <li><strong>Name</strong>: Categorical data - should show dropdown with unique values</li>
      <li><strong>Age</strong>: Numeric data - should show min/max range inputs</li>
      <li><strong>Salary</strong>: Money data (Chilean format) - should show numeric range filters</li>
      <li><strong>Start Date</strong>: Date data - should show from/to date pickers</li>
      <li><strong>Performance</strong>: Percentage data - should show numeric range filters</li>
    </ul>
    <p><strong>New Feature:</strong> Click the ▼ button in each column header to open the filter popup!</p>
  </div>
  
  <div class="test-section">
    <h3>Actions</h3>
    <button onclick="openTableViewer()">Open in Table Viewer</button>
    <button onclick="sendTestData()">Send Test Data</button>
  </div>

  <script>
    const testTableData = [
      ["Name", "Age", "Salary", "Start Date", "Performance"],
      ["Juan Pérez", "25", "$ 1.200.000", "2023-01-15", "85%"],
      ["María González", "32", "$ 1.800.500", "2022-06-20", "92%"],
      ["Carlos Silva", "28", "$ 1.450.000", "2023-03-10", "78%"],
      ["Ana Rodriguez", "35", "$ 2.100.750", "2021-11-05", "95%"],
      ["Pedro Martinez", "29", "$ 1.350.000", "2023-07-22", "88%"],
      ["Laura Fernández", "31", "$ 1.975.250", "2022-02-14", "90%"],
      ["Diego López", "26", "$ 1.275.000", "2023-05-08", "82%"],
      ["Sofia Herrera", "33", "$ 2.250.000", "2021-09-30", "97%"]
    ];

    function openTableViewer() {
      const viewer = window.open('table-viewer.html', '_blank', 
        'width=1200,height=800,scrollbars=yes,resizable=yes');
      
      // Wait for the viewer to load, then send data
      setTimeout(() => {
        sendTestData(viewer);
      }, 1000);
    }

    function sendTestData(targetWindow = null) {
      const target = targetWindow || window.open('table-viewer.html', '_blank');
      
      const tableData = {
        type: 'TABLE_DATA',
        tableData: testTableData,
        metadata: {
          title: 'Employee Test Data',
          source: 'Column Filter Test',
          index: 0
        }
      };

      // Send after a short delay to ensure the viewer is ready
      setTimeout(() => {
        target.postMessage(tableData, '*');
      }, 500);
    }

    // Listen for requests from the table viewer
    window.addEventListener('message', (event) => {
      if (event.data.type === 'REQUEST_TABLE_DATA') {
        console.log('Table viewer requesting data');
        sendTestData(event.source);
      }
    });
  </script>
</body>
</html>